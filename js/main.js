"use strict";window.onload=function(){function e(e,t){console.log("sending..",t," converted: ",web3.fromAscii(t),e),k.addChild.sendTransaction(web3.fromAscii(t),e,{from:web3.eth.accounts[0],gas:web3.getGas,to:w},function(e,t){e?console.log(e):console.log("Receiver has been set: "+t)})}function t(e,t,n,a,o,s){console.log("sending..",e,t,n,a,o,s),k.AddTask.sendTransaction(e,t,n,a,o,s,{from:web3.eth.accounts[0],gas:web3.getGas,to:w},function(e,t){e?console.log(e):console.log("Receiver has been set: "+t)})}function n(e,t){return new Promise(function(n,a){console.log("sending..",e,t),k.CompleteTask.sendTransaction(e,t,{from:web3.eth.accounts[0],gas:web3.getGas,to:w},function(e,t){e?a(error):n(t)})})}function a(e,t){return new Promise(function(n,a){console.log("sending..",e,t),k.RejectReviewedTask.sendTransaction(e,t,{from:web3.eth.accounts[0],gas:web3.getGas,to:w},function(e,t){e?(console.log(e),a(error)):(console.log("Receiver has been set: "+t),n(t))})})}function o(e,t,n,a){for(var o=0;o<e.length;o++){var s=e[o];s.onclick=function(e){e.preventDefault(),"toggle"===t&&s.classList.toggle("open"),"remove"===t&&s.classList.remove(n),"add"===t&&s.classList.add(n),a()}}}function s(e){console.log("layout: ",e),document.getElementById(""+e).classList.add("active"),"Parent"==e&&l()}function l(){var e=3;A&&(document.getElementById("BuyGo").classList.add("hidden"),e--),N&&(document.getElementById("AddFirstChild").classList.add("hidden"),e--),E&&(document.getElementById("AddFirstTask").classList.add("hidden"),e--),e&&document.getElementById("QuickStartGuide").classList.add("active")}function i(){return"undefined"!=typeof web3&&new Promise(function(e,t){web3.eth.getAccounts(function(n,a){n?t(n):(a=a.length>1?a[0]:a,e(a))})})}function c(e){return new Promise(function(t,n){web3.eth.getBalance(e,function(e,a){e?n(e):t(a)})})}function d(){return new Promise(function(e,t){var n=web3.eth.accounts[0];console.log(n),C.getParentsChildren.call(n,function(n,a){n?t(n):e(a)})})}function r(e){return new Promise(function(t,n){C.getChildByAddress.call(e,function(e,a){e?n(e):t(a)})})}function u(){var e=web3.eth.accounts[0];return console.log(e),new Promise(function(t,n){C.checkIfChild.call(e,function(e,a){e?n(e):t(a)})})}function m(e){var t="undefined"!=typeof e&&e>0?e:1;return new Promise(function(e,n){C.getActiveTaskIDs.call(t,function(t,a){t?n(t):e(a)})})}function y(e){console.log("checking for reviewables");var t="undefined"!=typeof e&&e>0?e:1;return new Promise(function(e,n){C.getReviewableTaskIDs.call(t,function(t,a){t?n(t):e(a)})})}function p(){return I?new Promise(function(e,t){C.getReviewTasksByParentAddress.call(I,function(n,a){n?t(n):e(a)})}):void i().then(function(e){I=e[0],this.checkForTaskCreated})}function f(e){console.log("call a clone!");for(var t=e[0],n=e[1],a=0;a<n.length;a++){var o=document.getElementsByClassName("child-template");if(o.length){var s=o[0].cloneNode(!0);s.getElementsByClassName("child-name")[0].innerHTML=web3.toAscii(t[a]).replace(/['"]+/g,""),s.getElementsByClassName("action-container")[0].setAttribute("data-child",n[a]),s.classList.add("active"),document.getElementById("ChildrenContainer").appendChild(s)}}}try{var g=(new Web3(web3.currentProvider||new Web3.providers.HttpProvider("https://testnet-rpc.gochain.io:443")),new Web3(new Web3.providers.HttpProvider("https://testnet-rpc.gochain.io:443"))),v=JSON.parse('[{"constant":true,"inputs":[{"name":"_parent","type":"address"}],"name":"checkIfChild","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_name","type":"bytes32"},{"name":"_child","type":"address"}],"name":"addChild","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"getAllTasks","outputs":[{"name":"","type":"bytes32[]"},{"name":"","type":"address[]"},{"name":"","type":"uint128[]"},{"name":"","type":"bool[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"Children","outputs":[{"name":"name","type":"bytes32"},{"name":"parentAddress","type":"address"},{"name":"childAddress","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_taskId","type":"uint128"}],"name":"doChangeTaskToReview","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_value","type":"bytes32"},{"name":"_assignee","type":"address"},{"name":"_bounty","type":"uint128"}],"name":"addTodoItem","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"_creator","type":"address"}],"name":"getReviewTasksByParentAddress","outputs":[{"name":"","type":"bytes32[]"},{"name":"","type":"uint128[]"},{"name":"","type":"bool[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_taskId","type":"uint128"}],"name":"doRejectTaskToReview","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"_parent","type":"address"}],"name":"getParentsChildren","outputs":[{"name":"","type":"bytes32[]"},{"name":"","type":"address[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"Tasks","outputs":[{"name":"value","type":"bytes32"},{"name":"creator","type":"address"},{"name":"assignee","type":"address"},{"name":"bounty","type":"uint128"},{"name":"active","type":"bool"},{"name":"review","type":"bool"},{"name":"paid","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_assignee","type":"address"}],"name":"getActiveTasksByChildAddress","outputs":[{"name":"","type":"bytes32[]"},{"name":"","type":"uint128[]"},{"name":"","type":"bool[]"}],"payable":false,"stateMutability":"view","type":"function"}]'),h=web3.eth.contract(v),b=g.eth.contract(v),w="0x2E56cae2c5e4d960A783576c6627c31af77a8eb8",k=h.at(w),C=b.at(w),B="Child",N=0,E=0;u().then(function(e){console.log("is child ?",e),0==e&&(B="Parent",N=0,d().then(function(e){var t=e[1],n=e[0];console.log("children??",e,n.length),n.length>0&&(console.log("test"),f(e)),t.length>0&&(N=1),p().then(function(e){var t=e.length;t>0&&(E=1),s(B)})}))}),0==N?(console.log("you are a parent"),y().then(function(e){if(e.length>0)for(console.log("these are your reviewable tasks",e),H=0;H<e.length;H++){var t=document.getElementsByClassName("reviewable-task");if(t.length){var n=t[0].cloneNode(!0);n.classList.add("active"),document.getElementById("ReviewAbleTaskContainer").appendChild(n)}}else console.log("no tasks for review.")})):(console.log("you are a childs."),m().then(function(e){if(e.length>0)for(console.log("these are your active tasks",e),H=0;H<e.length;H++){var t=document.getElementsByClassName("reviewable-task");if(t.length){var n=t[0].cloneNode(!0);n.classList.add("active"),document.getElementById("ReviewAbleTaskContainer").appendChild(n)}}else console.log("no tasks for review.")}))}catch(T){console.log("error loading web3.",T)}var I=0,A=0;"undefined"==typeof window.web3?console.error("Please use a web3 browser"):i().then(function(e){"undefined"==typeof e?console.log("no wallet."):(I=e[0],c(I).then(function(e){var t='<i class="fas fa-usd-circle"></i> '+web3.fromWei(e,"ether").toFixed(2)+" GO";g.fromWei(e,"ether").toFixed(2)>0&&(A=1),document.getElementById("GoBalance").innerHTML=t}))});var P=document.getElementsByClassName("test-metamask");o(P,"","",function(){metaMaskAuth()});var L=document.getElementsByClassName("cancelChild");o(L,"remove","open",function(){document.getElementsByClassName("AddNewChild")[0].classList.remove("open"),document.getElementById("NewChild").classList.remove("active")});var M=document.getElementsByClassName("AddNewChild");o(M,"toggle","open",function(){document.getElementById("NewChild").classList.toggle("active")});var R=document.getElementsByClassName("addNewChildSubmit")[0];R.onclick=function(t){t.preventDefault();var n=document.getElementById("NewChildWalletAddress").value,a='"'+document.getElementById("NewChildNickname").value+'"';e(n,a)};var D=document.getElementsByClassName("addTaskForChild");o(D,"toggle","open",function(){document.getElementById("NewTask").classList.toggle("active")});var _=document.getElementById("AddNewTaskSubmit");_.onclick=function(e){e.preventDefault(),console.log("you clicked submit new task");var n=document.getElementById("TaskChildAddress").value,a='"'+document.getElementById("TaskDescription").value+'"',o=document.getElementById("TaskEndDate").value;o=new Date(o).getTime();var s=document.getElementById("TaskBounty").value,l=document.getElementById("TaskUseDecay").value===!0,i=10;t(n,a,o,s,l,i)};var G=document.getElementsByClassName("cancelTask");o(G,"remove","open",function(){document.getElementById("NewTask").classList.remove("active")});var W=document.getElementsByClassName("AddNewTask");W.length&&(W[0].onclick=function(e){e.preventDefault(),console.log("cloneable!");var t=document.getElementsByClassName("cloneable");if(t.length){var n=t[0].cloneNode(!0);document.getElementById("TaskBlocks").appendChild(n)}});for(var F=document.getElementsByClassName("mark-task-as-completed"),H=0;H<F.length;H++){var S=F[H];S.onclick=function(e){e.preventDefault();var t=S.dataset.taskid,a=S.dataset.childaddress;r(a).then(function(e){var a=S.dataset.childid;n(t,a).then(function(e){S.parentNode.parentNode.parentNode.removeChild(S.parentNode.parentNode)})})}}for(var j=document.getElementsByClassName("reject-task"),H=0;H<j.length;H++){var S=j[H];S.onclick=function(e){e.preventDefault();var t=S.dataset.taskid,n=S.dataset.childaddress;a(t,n).then(function(e){S.parentNode.parentNode.parentNode.removeChild(S.parentNode.parentNode)})}}};